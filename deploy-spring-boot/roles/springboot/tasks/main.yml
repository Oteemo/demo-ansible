---
- name: Install Java 1.8
  yum: name=java-1.8.0-openjdk state=present

- name: Remove java 1.7
  yum: name=java-1.7.0-openjdk state=absent

- name: httpd
  yum: name=httpd state=present

- name: Create working directory
  file: path=/opt/spring-boot state=directory

# - name: Create Configuration for profile being used
#   copy: content="RUN_ARGS=--spring.profiles.active=ec2" dest=/opt/spring-boot-ec2-demo/spring-boot-ec2-demo.conf

- name: Copy spring boot artifact
  command: aws s3 cp s3://swf-spring-boot/todo-1.0.0.war /opt/spring-boot/ --region=us-east-1
  notify:
    - restart app

- name: add user "springboot"
  user: name=springboot

- name: disable springboot login shell
  command: chsh -s /sbin/nologin springboot

- name: Change ownership of jar
  file: path=/opt/spring-boot/todo-1.0.0.war owner=springboot group=springboot state=file mode=0500

- name: Create symlink
  file: src=/opt/spring-boot/todo-1.0.0.war path=/etc/init.d/todo-1.0.0 state=link

- name: Start spring springboot
  service: name=todo-1.0.0 state=started enabled=yes

- name: Wait for spring boot to started
  wait_for: port=8080
