---
# Creates azure instance with SQL server already installed

- hosts: localhost
  connection: local
  gather_facts: no
  
  vars:
    azure_location: westus
    azure_resgrp: gpryzby
    azure_vm_name: ts-crtm
    azure_pubip_name: "{{ azure_resgrp}}pip"
    azure_vnet: "{{ azure_resgrp }}vnet"
    azure_subnet: "{{ azure_resgrp }}snet"
    
  tasks:
    - name: Create a resource group
      azure_rm_resourcegroup:
        name: "{{ azure_resgrp }}"
        location: "{{ azure_location }}"

    - name: Create Azure Deploy
      azure_rm_deployment:
        resource_group_name: "{{ azure_resgrp }}"
        parameters:
          adminUsername:
            value: 'crm'
          adminPassword:
            value: 'SpaceGhost!!1'
          dnsLabelPrefix:
            value: "{{ azure_vm_name }}"
          vmName:
            value: "{{ azure_vm_name }}"
          publicIPAddressName: 
           value: "{{ azure_pubip_name }} "
          virtualNetworkName: 
            value: "{{ azure_vnet }} "
          subnetName: 
            value: "{{ azure_snet }} "
        template_link: 'https://raw.githubusercontent.com/gpryzby/demo-ansible/CRM/CRM/files/sqlserver-deploy.json'
        state: present
